# 6. Деплой

Проект AIRBRO Business развертывается как два отдельных приложения: фронтенд и бэкенд. Процессы деплоя полностью автоматизированы с помощью GitHub Actions.

## Фронтенд

- **Платформа:** [Vercel](https://vercel.com/)
- **Workflow:** [`deploy-frontend.yml`](../.github/workflows/deploy-frontend.yml)
- **URL:** `https://aibrobusiness.com` (пример)

### Процесс деплоя

1.  **Триггер:** Деплой запускается автоматически при каждом `push` в ветку `main`, если изменения затрагивают файлы фронтенда (`src/**`, `public/**`, `package.json` и т.д.).

2.  **Сборка (Build):**
    - GitHub Action запускает команду `npm run build`.
    - Во время сборки используются продакшн-переменные окружения (например, `VITE_API_URL_PROD`), которые хранятся в секретах репозитория GitHub.

3.  **Развертывание на Vercel:**
    - Используется action `amondnet/vercel-action`, который отправляет собранные файлы (`dist`) в Vercel.
    - Vercel автоматически назначает новый деплой на продакшн-домен.

4.  **Загрузка Source Maps в Sentry:**
    - После успешного деплоя, `source maps` (карты исходного кода) загружаются в Sentry. Это позволяет видеть читаемые стектрейсы ошибок в продакшене.

5.  **Уведомление в Slack:**
    - В конце воркфлоу отправляется уведомление в Slack о статусе деплоя (успех или провал).

## Бэкенд

- **Платформа:** [Railway](https://railway.app/)
- **Workflow:** [`deploy-backend.yml`](../.github/workflows/deploy-backend.yml)
- **URL:** `https://api.aibrobusiness.com` (пример)

### Процесс деплоя

1.  **Триггер:** Деплой запускается автоматически при каждом `push` в ветку `main`, если изменения затрагивают папку `backend/**`.

2.  **Установка Railway CLI:**
    - В воркфлоу устанавливается официальный CLI-инструмент от Railway.

3.  **Развертывание на Railway:**
    - Выполняется команда `railway up`, которая автоматически определяет тип проекта (Node.js), собирает его (если нужно) и развертывает.
    - Railway использует `Dockerfile` или `Nixpacks` для сборки и запуска сервиса. Переменные окружения (например, `DATABASE_URL`, `JWT_SECRET`) должны быть настроены в самом проекте на Railway.

4.  **Применение миграций:**
    - После деплоя выполняется команда `railway run npx prisma migrate deploy`, чтобы применить любые новые миграции к продакшн-базе данных.

5.  **Проверка работоспособности (Health Check):**
    - Воркфлоу делает паузу на 10 секунд, а затем отправляет запрос на эндпоинт `/health`. Если сервис не отвечает статусом `200 OK`, воркфлоу завершается с ошибкой.

6.  **Уведомление в Slack:**
    - Как и в случае с фронтендом, отправляется уведомление о статусе деплоя.

---

**Далее:** [07 - CI/CD](./07_CI_CD.md)
